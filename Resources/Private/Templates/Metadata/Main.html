<f:comment>
<!--
 * (c) Kitodo. Key to digital objects e.V. <contact@kitodo.org>
 *
 * This file is part of the Kitodo and TYPO3 projects.
 *
 * @license GNU General Public License version 3 or later.
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
-->
</f:comment>
<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:comment>
    <dl>
        {metadata -> f:format.html()}
    </dl>

    NOTE: We assume unescaped values
</f:comment>
<div class="dlf-metadata-container">
    <f:if condition="{useIiif}">
        <f:then>
            <f:render partial="Metadata/IiifEntries" arguments="{_all}"/>
        </f:then>
        <f:else>
            <f:for each="{documentMetadataSections}" as="documentMetadataSection" iteration="sectionIterator">
                <dl class="tx-dlf-metadata-titledata" data-metadata-list data-dlf-section="{documentMetadataSection._id}" {f:if(condition: "!{documentMetadataSection._active}", then: "hidden")}>
                    <f:for each="{configMetadata}" as="configObject">
                        <f:if condition="{documentMetadataSection.{configObject.indexName}}">
                            <f:render partial="Metadata/Entries" arguments="{_all}" />
                        </f:if>
                    </f:for>
                </dl>
            </f:for>
        </f:else>
    </f:if>
</div>

<script>
    window.addEventListener('tx-dlf-documentLoaded', (e) => {
        // TODO(client-side): When there are multiple instances of metadata plugin?
        const container = document.querySelector('.dlf-metadata-container');
        const rootline = {settings.rootline};

        new dlfMetadata(e.detail.docController, { container, rootline });
    });
</script>
